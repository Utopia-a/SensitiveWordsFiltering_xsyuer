## 一、项目介绍

这是一个基于KMP算法实现的，用C++程序语言编写的敏感词汇过滤程序。

本项目演示了：

```
- 敏感词库的加载
- KMP 字符串匹配算法
- UTF-8 编码下的汉字字符计数
- 字符串替换操作  
```

对于KMP算法的介绍，感兴趣的话，可以访问如下链接学习：https://oi-wiki.org/string/kmp/

## 二、功能介绍

### 1、词汇库文件的加载 

这个功能是利用了C++语言的oi文件读写功能。通过按行从文件中读取词汇，并且存入`vector`数组，为后续的搜索做准备。

### 2、字符串匹配算法实现（KMP）

当然，可以利用低效的暴力匹配，在最简单的“暴力匹配”里，若发现当前位置匹配不上，就会把模式串整体往后挪一位，从头重新比较，很明显时间复杂度会比较惊人，特别是在该程序中，需要多次调用匹配算法

在数据结构这门课程中，我们学到了KMP匹配算法，这个算法的特点通过分析模式串（pattern），维护一个next数组，当匹配失败时，不需要从头重新开始，而是根据next数组来跳过不必要的重复比较。

```
********求解next数组的核心代码********
for (int i = 1; i < plen; i++) {
    while (k > 0 && pattern[k] != pattern[i]) {
        k = next[k - 1];
    }
    if (pattern[i] == pattern[k]) {
        k = k + 1;
    }
    next[i] = k;
}

********kmp算法的核心代码********
其中text:表示母串 ;pattern:表示模式串;n：母串的长度 ;m:模式串的长度 ;
int k = 0;
for (int i = 0; i < n; i++) {
	while (k > 0 && text[i] != pattern[k]) {
		k = next[k - 1];
	}
	if (text[i] == pattern[k]) {
		k++;
	}
	if (k == m) {//匹配成功
		matches.push_back(i - m + 1);//将字串的开头存入match容器中
		k = next[k - 1];//回溯，继续向前匹配
	}
}
```



### 3、敏感词过滤

在敏感词替换过程中，一个技术难点是 **汉字在字符串中的存储长度不固定**。在 UTF-8 编码中，英文字母一般占用 1 个字节，而汉字通常是 3 个字节（有些特殊字符或表情符号可能会占用 2 字节或 4 字节）。

如果直接用单个 `*` 字节去替换汉字的某个字节，会破坏原有的字节序列，导致输出乱码，无法正常显示完整字符。

为避免这种问题，本程序采用了**先移除、后插入**的方案：当检测到敏感词时，先使用 `string` 的 `erase` 函数将整段敏感词从原文本中删除，然后根据该词中实际的 **字符数量**（而不是字节数，如下函数实现）统计需要替换的长度，最后生成相同数量的 `*` 字符串插入到原位置，从而保证显示结果既正确又不会出现乱码。

```
**************核心代码如下**************
int countUTF8Chars(const string& str) {
	int count = 0;
	for (size_t i = 0; i < str.length(); ) {
		if ((str[i] & 0x80) == 0) {
			// ASCII字符 (0xxxxxxx)
			i++;
			count++;
		}
		else if ((str[i] & 0xE0) == 0xC0) {
			// 2字节UTF-8字符
			i += 2;
			count++;
		}
		else if ((str[i] & 0xF0) == 0xE0) {
			// 3字节UTF-8字符 (汉字常用)
			i += 3;
			count++;
		}
		else if ((str[i] & 0xF8) == 0xF0) {
			// 4字节UTF-8字符
			i += 4;
			count++;
		}
		else {
			// 错误或未知字节，只跳过，不计数
			i++;
		}
	}
	return count;
}
```



## 三、文件结构

```
.
├── main.cpp           // 程序入口及具体函数实现
├── Mess_detection.h   // 类定义
├── VocFile.txt        // 敏感词词库（需用户自建）
└── README.md          // 项目说明文档
```



## 四、结语

该项目是一个基于 **C++** 的简易敏感词检测与过滤实现示例，适合初学者学习字符串处理、KMP 算法、文件读写与编码处理等知识点。 欢迎大家基于此项目进行二次开发，或改造成可用于网页后端、聊天软件等实际场景。



